# 用户资料页面实践匹配按钮功能

## 功能概述

为了改善实践匹配功能的用户体验，特别是在移动端，我们在用户资料页面上添加了"我想和他约实践"按钮。这样用户就可以在浏览其他用户资料时直接添加实践兴趣，而不需要专门访问实践匹配页面。

## 新增功能

### 1. 用户资料页面按钮

- **位置**: 用户资料页面的控制按钮区域（与"私信"、"管理员"等按钮并列）
- **显示条件**: 
  - 用户已登录
  - 不是查看自己的资料页面
  - 实践匹配功能已启用
- **功能**: 
  - 点击添加/移除实践兴趣
  - 实时显示当前状态（已添加/未添加）
  - 支持加载状态显示

### 2. 移动端优化

- **响应式设计**: 在移动端自动隐藏按钮文字，只显示图标
- **触摸友好**: 按钮大小适配移动端触摸操作
- **圆形按钮**: 在移动端使用圆形按钮设计，节省空间

### 3. 视觉反馈

- **状态指示**: 
  - 未添加：蓝色按钮，显示"我想和他约实践"
  - 已添加：绿色按钮，显示"已添加实践兴趣"
- **加载状态**: 操作时显示"处理中..."
- **成功/错误提示**: 使用Toast消息提供操作反馈

## 技术实现

### 文件结构

```
plugins/discourse-plugin-matching/
├── assets/javascripts/discourse/
│   ├── components/
│   │   ├── practice-matching-profile-button.js
│   │   └── practice-matching-profile-button.hbs
│   └── templates/connectors/user-profile-controls/
│       └── practice-matching-button.hbs
├── assets/javascripts/initializers/
│   └── practice-matching.js
├── assets/stylesheets/
│   └── practice-matching.scss
└── config/locales/
    ├── client.zh_CN.yml
    └── client.en.yml
```

### 核心组件

#### PracticeMatchingProfileButton

- **功能**: 处理按钮的显示逻辑和用户交互
- **状态管理**: 跟踪当前用户是否已添加实践兴趣
- **API调用**: 与后端API交互，添加/移除实践兴趣
- **错误处理**: 处理网络错误和API错误

#### 插件出口点

- **位置**: `user-profile-controls`
- **条件渲染**: 只在适当的情况下显示按钮
- **数据传递**: 将用户信息传递给组件

### 样式设计

#### 桌面端
- 标准按钮样式，包含图标和文字
- 悬停效果和状态变化
- 与现有按钮保持一致的设计语言

#### 移动端
- 圆形图标按钮
- 隐藏文字，只显示图标
- 触摸友好的尺寸（44px）

## 使用方法

### 1. 添加实践兴趣

1. 访问任意用户的资料页面
2. 在控制按钮区域找到"我想和他约实践"按钮
3. 点击按钮添加实践兴趣
4. 系统会显示成功提示

### 2. 移除实践兴趣

1. 访问已添加实践兴趣的用户资料页面
2. 按钮会显示为"已添加实践兴趣"状态
3. 点击按钮移除实践兴趣
4. 系统会显示成功提示

### 3. 查看匹配状态

1. 访问实践匹配页面 (`/practice-matching`)
2. 查看"我的实践兴趣"和"双向匹配"列表
3. 当形成双向匹配时会收到通知

## 配置选项

### 站点设置

- `practice_matching_enabled`: 启用/禁用整个实践匹配功能
- `practice_matching_min_trust_level`: 使用此功能的最低信任等级

### 国际化

支持中文和英文两种语言：

- **中文**: "我想和他约实践" / "已添加实践兴趣"
- **英文**: "I want to practice with them" / "Already interested"

## 测试

### 自动化测试

运行测试脚本：
```bash
./plugins/discourse-plugin-matching/test-profile-button.sh
```

### 手动测试

1. **功能测试**:
   - 访问其他用户资料页面
   - 测试添加/移除实践兴趣
   - 验证状态变化和提示信息

2. **移动端测试**:
   - 在移动设备或浏览器开发者工具中测试
   - 验证按钮的响应式设计
   - 测试触摸操作

3. **权限测试**:
   - 测试未登录用户（不应显示按钮）
   - 测试查看自己资料页面（不应显示按钮）
   - 测试不同信任等级用户的权限

## 故障排除

### 常见问题

1. **按钮不显示**
   - 检查用户是否已登录
   - 确认不是查看自己的资料页面
   - 验证实践匹配功能已启用

2. **按钮点击无响应**
   - 检查浏览器控制台是否有错误
   - 验证API端点是否正常工作
   - 确认网络连接正常

3. **样式显示异常**
   - 清除浏览器缓存
   - 重新编译前端资源
   - 检查CSS文件是否正确加载

### 调试步骤

1. 检查浏览器开发者工具的控制台
2. 查看网络请求是否成功
3. 验证组件是否正确渲染
4. 检查样式是否正确应用

## 未来改进

### 计划中的功能

1. **批量操作**: 支持在用户列表中批量添加实践兴趣
2. **推荐系统**: 基于用户兴趣推荐潜在的实践伙伴
3. **通知优化**: 改进匹配通知的显示方式
4. **统计分析**: 添加实践匹配的使用统计

### 用户体验改进

1. **动画效果**: 添加按钮状态变化的动画
2. **快捷操作**: 支持键盘快捷键
3. **个性化**: 允许用户自定义按钮样式
4. **集成**: 与其他Discourse功能更好地集成

## 贡献指南

### 开发环境设置

1. 克隆Discourse仓库
2. 安装插件到 `plugins/` 目录
3. 运行 `./launcher rebuild app`
4. 启动开发服务器

### 代码规范

- 遵循Discourse的代码风格
- 使用ES6+语法
- 添加适当的注释
- 编写测试用例

### 提交PR

1. Fork项目仓库
2. 创建功能分支
3. 提交代码更改
4. 创建Pull Request
5. 等待代码审查

## 许可证

本项目遵循Discourse的许可证条款。 